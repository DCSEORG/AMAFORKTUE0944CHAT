@using ExpenseManagement.Services
@inject IExpenseService ExpenseService
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Expense Management</title>
    <link rel="stylesheet" href="~/css/site.css" />
</head>
<body>
    @if (ExpenseService.UseDummyData && !string.IsNullOrEmpty(ExpenseService.LastError))
    {
        <div class="error-banner">
            <div class="error-content">
                <strong>‚ö†Ô∏è Database Connection Error</strong>
                <p>@ExpenseService.LastError</p>
                <small>File: @ExpenseService.LastErrorFile | Line: @ExpenseService.LastErrorLine</small>
                <p class="error-note">Displaying dummy data for demonstration purposes.</p>
            </div>
        </div>
    }
    
    <header class="navbar">
        <div class="nav-brand">
            <span class="nav-icon">üíº</span>
            <span class="nav-title">Expense Management</span>
        </div>
        <nav class="nav-links">
            <a href="/Index" class="nav-link @(ViewData["ActivePage"]?.ToString() == "Dashboard" ? "active" : "")">Dashboard</a>
            <a href="/Expenses" class="nav-link @(ViewData["ActivePage"]?.ToString() == "Expenses" ? "active" : "")">Expenses</a>
            <a href="/NewExpense" class="nav-link @(ViewData["ActivePage"]?.ToString() == "NewExpense" ? "active" : "")">New Expense</a>
            <a href="/Approvals" class="nav-link @(ViewData["ActivePage"]?.ToString() == "Approvals" ? "active" : "")">Approvals</a>
            <a href="/swagger" class="nav-link" target="_blank">API Docs</a>
        </nav>
    </header>

    <main class="main-content">
        @RenderBody()
    </main>

    <div id="chat-widget" class="chat-widget">
        <button id="chat-toggle" class="chat-toggle" onclick="toggleChat()">
            üí¨
        </button>
        <div id="chat-container" class="chat-container hidden">
            <div class="chat-header">
                <span>AI Assistant</span>
                <button onclick="toggleChat()" class="chat-close">&times;</button>
            </div>
            <div id="chat-messages" class="chat-messages">
                <div class="chat-message assistant">
                    <div class="message-content">
                        Hello! I'm your Expense Management Assistant. How can I help you today?
                    </div>
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" id="chat-input" class="chat-input" placeholder="Type a message..." onkeypress="handleKeyPress(event)" />
                <button onclick="sendMessage()" class="chat-send">Send</button>
            </div>
        </div>
    </div>

    <script src="~/js/chat.js"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
